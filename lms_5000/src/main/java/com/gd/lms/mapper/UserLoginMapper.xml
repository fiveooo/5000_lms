<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gd.lms.mapper.UserLoginMapper">

	<!-- 회원가입시 ID 중복검사 -->
	<select id="selectUserIdCheck" resultType="int">
		SELECT
			count(*)
		FROM user
		WHERE user_id = #{userId}
	</select>
	
	<!-- ID PW 일치하는 정보 레벨하고 계정활성화여부  -->
	<select id="selectUserLogin" parameterType="com.gd.lms.vo.User" resultType="com.gd.lms.vo.User">
		SELECT
			user_id userId,
			user_name userName,
			user_level userLevel,
			user_active userActive
		FROM user
		WHERE user_id = #{userId} AND user_pw = password(#{userPw})
	</select>
	
	<!-- 마이페이지 나의 정보 조회하기 -->
	<select id="selectUserInfo" parameterType="String" resultType="com.gd.lms.vo.User">
		SELECT
			user_id userId,
			user_pw userPw,
			user_level userLevel,
			user_name userName,
			user_email userEmail,
			user_tel userTel,
			user_gender userGender,
			create_date createDate,
			lastlogin_date lastloginDate
		FROM user
		WHERE user_id = #{userId}
	</select>
	
	<!-- 회원가입시 들어가는 정보 쿼리 -->
	<insert id="insertUser" parameterType="com.gd.lms.vo.User">
		INSERT INTO user (
			user_id,
			user_pw,
			user_level,
			user_name,
			user_email,
			user_tel,
			user_gender,
			create_date,
			update_date,
			lastlogin_date
		) VALUES (
			#{userId},
			password(#{userPw}),
			#{userLevel},
			#{userName},
			#{userEmail},
			#{userTel},
			#{userGender},
			NOW(),
			NOW(),
			NOW()
		)
	</insert>
	
	<!-- 관리자 회원가입 쿼리 -->
	<insert id="insertAdmin" parameterType="com.gd.lms.vo.Admin">
		Insert Into admin (
			user_id,
			admin_name,
			admin_email,
			admin_tel,
			admin_gender,
			access_date,
			update_date,
			position_no
		) Values (
			#{userId},
			#{adminName},
			#{adminEmail},
			#{adminTel},
			#{adminGender},
			Now(),
			Now(),
			#{positionNo}
		)
	</insert>
	
	<!-- 학생 회원가입 쿼리 -->
	<insert id="insertStudent" parameterType="com.gd.lms.vo.Student">
		Insert Into student (
			user_id,
			st_name,
			st_email,
			st_tel,
			st_gender,
			access_date,
			update_date,
			major_no
		) Values (
			#{userId},
			#{stName},
			#{stEmail},
			#{stTel},
			#{stGender},
			Now(),
			Now(),
			#{majorNo}
		)
	</insert>
	
	<!-- 교수 회원가입 쿼리 -->
	<insert id="insertProfessor" parameterType="com.gd.lms.vo.Professor">
		Insert Into professor (
			user_id,
			pro_name,
			pro_email,
			pro_tel,
			pro_gender,
			access_date,
			update_date,
			major_no
		) Values (
			#{userId},
			#{proName},
			#{proEmail},
			#{proTel},
			#{proGender},
			Now(),
			Now(),
			#{majorNo}
		)
	</insert>
	
	<!-- 유저 이메일 변경 -->
	<update id="modifyUserEmail">
		Update user
		Set user_email = #{userEmail}
		Where user_id = #{userId}
	</update>
	
	<!-- 운영자 이메일 변경 -->
	<update id="modifyAdminEmail">
		Update admin
		Set admin_email = #{userEmail}
		Where user_id = #{userId}
	</update>
	
	<!-- 학생 이메일 변경 -->
	<update id="modifyStudentEmail">
		Update student
		Set st_email = #{userEmail}
		Where user_id = #{userId}
	</update>
	
	<!-- 교수 이메일 변경 -->
	<update id="modifyProEmail">
		Update professor
		Set pro_email = #{userEmail}
		Where user_id = #{userId}
	</update>
		
	<!-- 유저 번호 변경 -->
	<update id="modifyUserTel">
		Update user
		Set user_tel = #{userTel}
		Where user_id = #{userId}
	</update>
	<!-- 운영자 번호 변경 -->
	<update id="modifyAdminTel">
		Update admin
		Set admin_tel = #{userTel}
		Where user_id = #{userId}
	</update>
	<!-- 학생 번호 변경 -->
	<update id="modifyStudentTel">
		Update student
		Set st_tel = #{userTel}
		Where user_id = #{userId}
	</update>
	<!-- 교수 번호 변경 -->
	<update id="modifyProTel">
		Update professor
		Set pro_tel = #{userTel}
		Where user_id = #{userId}
	</update>
	
</mapper>